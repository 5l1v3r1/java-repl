<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01//EN"
        "http://www.w3.org/TR/html4/strict.dtd">
<html>
<head>
    <title>Java REPL</title>
    <meta name="Content-Type" content="text/html; charset=UTF-8">

    <link href="style.css" rel="stylesheet" type="text/css">
    <link href="gh-fork-ribbon.css" rel="stylesheet" type="text/css">
    <script type="text/javascript" src="jquery.js"></script>
    <script type="text/javascript" src="jquery.console.js"></script>

    <script type="text/javascript">
        var requesting = false;
        var clientId = null;

        $(window).bind('beforeunload', function () {
            $.ajax({
                type: 'POST',
                async: false,
                url: '/remove',
                data: 'id=' + clientId});
        });

        $(document).ready(function () {
            var console1 = $('<div>');
            $('#console').append(console1);

            $.post('/create', function (data) {
                clientId = data.id;
            });

            var controller = console1.console({
                promptLabel: 'java> ',
                commandValidate: function (line) {
                    return !requesting;

                },
                commandHandle: function (line, report) {
                    $.post('/execute', {id: clientId, expression: line})
                            .done(function (data) {
                                var messages = [];

                                var hadError = false;

                                for (var i = 0; i < data.logs.length; i++) {
                                    var type = data.logs[i].type == "ERROR" ? "jquery-console-message-error" : "jquery-console-message-success";

                                    if (data.logs[i].type == "ERROR") {
                                        hadError = true;
                                    }
                                    messages.push({msg: data.logs[i].message, className: type})
                                }

                                if (!hadError) {
                                    _gaq.push(["_trackEvent", "console", "evaluation", "success"]);
                                } else {
                                    _gaq.push(["_trackEvent", "console", "evaluation", "error"]);
                                }

                                report(messages);
                                requesting = false;
                            })
                            .fail(function (xhr, textStatus, errorThrown) {
                                if (xhr.status === 504) {
                                    report([
                                        {msg: "Session timeout. Starting new session...", className: "jquery-console-message-error"}
                                    ]);
                                } else {
                                    report([
                                        {msg: errorThrown + ". Starting new session...", className: "jquery-console-message-error"}
                                    ]);
                                }

                                $.ajax({type: 'POST', async: false, url: '/remove', data: 'id=' + clientId});
                                $.post('/create', function (data) {
                                    clientId = data.id;
                                });
                            });

                    return [];

                },
                welcomeMessage: "Welcome to Java REPL",
                autofocus: true,
                animateScroll: true,
                promptHistory: true,
                charInsertTrigger: function (keycode, line) {
                    return true;
                }
            });
        });
    </script>

    <script>
        (function (i, s, o, g, r, a, m) {
            i['GoogleAnalyticsObject'] = r;
            i[r] = i[r] || function () {
                (i[r].q = i[r].q || []).push(arguments)
            }, i[r].l = 1 * new Date();
            a = s.createElement(o),
                    m = s.getElementsByTagName(o)[0];
            a.async = 1;
            a.src = g;
            m.parentNode.insertBefore(a, m)
        })(window, document, 'script', '//www.google-analytics.com/analytics.js', 'ga');

        ga('create', 'UA-40421018-1', 'javarepl.com');
        ga('send', 'pageview');

    </script>


    <script type="text/javascript">
        var _gaq = _gaq || [];
        _gaq.push(['_setAccount', 'UA-40421018-1']);
        _gaq.push(['_trackPageview']);

        (function () {
            var ga = document.createElement('script');
            ga.type = 'text/javascript';
            ga.async = true;
            ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
            var s = document.getElementsByTagName('script')[0];
            s.parentNode.insertBefore(ga, s);
        })();

    </script>
</head>
<body>
<div id="wrapper">
    <div class="github-fork-ribbon-wrapper right">
        <div class="github-fork-ribbon"><a href="https://github.com/albertlatacz/java-repl">Fork me on GitHub</a></div>
    </div>
    <div id="content">
        <div id="header">
            <h1><span class="logo-javarepl">Java REPL</span></h1>
        </div>

        <div id="container">
            <div class="console" id="console"></div>
            <div id="changer">
                <p class="bottom">
                    Welcome to Java REPL, a simple Read-Eval-Print-Loop for Java language.
                </p>

                <p class="bottom">
                    Type in expression to evaluate or <code>:help</code> for more options.
                </p>
            </div>
        </div>

        <div class="footer">
            <p class="bottom">Â© <a href="https://github.com/albertlatacz/">Albert Latacz</a> and contributors.</p>
        </div>
    </div>
</div>
</body>
</html>